{% extends "base.html" %}

{% block head %}
{{ super() }}
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.12.1/bootstrap-table.css" rel="stylesheet">
{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-md-offset-1 col-md-10">
            <div class="table">
                <div id="toolbar">
                        <button id="remove" class="btn btn-danger" disabled>
                            <i class="glyphicon glyphicon-remove"></i> Delete
                        </button>
                        <button id="addnew" class="btn btn-success">
                            <i class="glyphicon glyphicon-plus"></i> Add New
                        </button>
                </div>
                <table id="table"
                       class="table table-sm table-striped table-bordered table-hover"
                       data-toggle="true"
                       data-toolbar="#toolbar"
                       data-search="true"
                       data-show-columns="true"
                       data-pagination="true"
                       data-page-size="{{ per_page }}"
                       data-show-refresh="true"
                       data-page-list="[10, 20, 50, 100, ALL]"
                       data-id-field="id"
                       data-editable-url="{{ base_url }}/update">
                </table>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.12.1/bootstrap-table.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.12.1/extensions/editable/bootstrap-table-editable.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.1/bootstrap3-editable/js/bootstrap-editable.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/webui-popover/2.1.15/jquery.webui-popover.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tooltip.js/1.3.0/umd/tooltip.js"></script>
<script type='text/javascript'>
    $(window).load(function(){
      var data = {{databases|tojson}};
      var columns = {{columns|tojson}};
      $(function() {
        $('#table').bootstrapTable({ 
          data: data,
          columns: columns,
        });
      });
      $('th').attr('data-editable', 'true');
    });
    $(document).ready(function() {
      $('[data-toggle="tooltip"]').tooltip();
      var actions = $("#table td:last-child").html();
      // Append table with add row form on add new button click
      $("#addnew").click(function(){
        $(this).attr("disabled", "disabled");
        var index = $("#table tbody tr:last-child").index();
            var row = '<tr>' +
                '<td><input type="text" class="form-control" name="name" id="name"></td>' +
                '<td></td>' +
                '<td></td>'
          '<td>' + actions + '</td>' +
            '</tr>';
          $("#table").append(row);   
        $("#table tbody tr").eq(index + 1).find(".add, .edit").toggle();
            $('[data-toggle="tooltip"]').tooltip();
        });
    });
</script>
{% endblock %}